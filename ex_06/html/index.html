<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Trang chủ</title>
        <link rel="stylesheet" href="../css/bootstrap.min.css" />
        <style>
            * {
                margin: 0;
                padding: 0;
            }

            #nameTable {
                font-size: 2rem;
            }
            .modal-dialog {
                max-width: 700px;
            }
        </style>
    </head>
    <body>
        <div class="container mt-5">
            <!-- Header -->
            <div class="row">
                <div class="col-12 box">
                    <img src="../img/website.png" alt="HỌC KỲ QUÂN ĐỘI HÈ" class="img-fluid w-100" />
                </div>
            </div>

            <!-- Navigation -->
            <div class="row">
                <div class="col-12 box">
                    <nav class="navbar-collapse mt-2">
                        <ul class="nav">
                            <li class="nav-item">
                                <a href="#" class="nav-link">Trang chủ SYC</a>
                            </li>
                            <li class="nav-item">
                                <a href="#" class="nav-link" data-toggle="modal" data-target="#modalForm">Đăng ký tham gia</a>
                            </li>
                        </ul>
                    </nav>
                </div>
            </div>

            <!-- Content -->
            <div class="row">
                <div class="col-12 box">
                    <p class="text-center mt-2" id="nameTable">DANH SÁCH HỌC VIÊN ĐĂNG KÝ</p>
                    <table class="table table-bodered table-striped">
                        <thead>
                            <tr>
                                <th>STT</th>
                                <th>Họ và tên</th>
                                <th>Giới tính</th>
                                <th>Số điện thoại</th>
                                <th>Ngày sinh</th>
                                <th>Địa chỉ</th>
                                <th>Khóa học</th>
                                <th>Học phí</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>1</td>
                                <td>Hoàng Lâm</td>
                                <td>Nam</td>
                                <td>090-008888</td>
                                <td>20/03/2010</td>
                                <td>123 Nguyễn Du P5 Gò Vấp TPHCM</td>
                                <td>4 tuần</td>
                                <td>8000000</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Footer -->
            <div class="row">
                <div class="col-12 box">
                    <p class="text-center">MSSV _ Họ và tên SV _ Lớp</p>
                </div>
            </div>

            <!-- Modal -->
            <div class="modal fade" id="modalForm" role="dialog" tabindex="-1" aria-labelledby="modalLabel" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title w-100 text-center" id="modalLabel">THÔNG TIN HỌC VIÊN</h5>
                            <button type="button" class="close" data-dismiss="modal">&times;</button>
                        </div>
                        <div class="modal-body m-3">
                            <form id="form">
                                <div class="form-group row">
                                    <label class="col-sm-3 col-form-label text-right">Họ và tên</label>
                                    <div class="col-sm-9">
                                        <input type="text" class="form-control" id="name" required />
                                        <div id="errName" class="err-msg text-danger"></div>
                                    </div>
                                </div>
                                <div class="form-group row">
                                    <label class="col-sm-3 col-form-label text-right">Giới tính</label>
                                    <div class="col-sm-9 align-self-center">
                                        <div class="form-check form-check-inline">
                                            <input type="radio" class="form-check-input" name="gender" value="Nam" />
                                            <label class="form-check-label">Nam</label>
                                        </div>
                                        <div class="form-check form-check-inline">
                                            <input type="radio" class="form-check-input" name="gender" value="Nữ" />
                                            <label class="form-check-label">Nữ</label>
                                        </div>
                                        <div id="errGender" class="err-msg text-danger"></div>
                                    </div>
                                </div>
                                <div class="form-group row">
                                    <label class="col-sm-3 col-form-label text-right">Số điện thoại</label>
                                    <div class="col-sm-9">
                                        <input type="text" class="form-control" id="phone" required />
                                        <div id="errPhone" class="err-msg text-danger"></div>
                                    </div>
                                </div>
                                <div class="form-group row">
                                    <label class="col-sm-3 col-form-label text-right">Ngày sinh</label>
                                    <div class="col-sm-9">
                                        <input type="date" class="form-control" id="birthday" required />
                                        <div id="errBirthday" class="err-msg text-danger"></div>
                                    </div>
                                </div>
                                <div class="form-group row">
                                    <label class="col-sm-3 col-form-label text-right">Địa chỉ</label>
                                    <div class="col-sm-9">
                                        <input type="text" class="form-control" id="address" required />
                                        <div id="errAddress" class="err-msg text-danger"></div>
                                    </div>
                                </div>
                                <div class="form-group row">
                                    <label class="col-sm-3 col-form-label text-right">Bạn muốn tham gia khóa nào?</label>
                                    <div class="col-sm-9 align-self-center">
                                        <select class="form-control" id="course" required>
                                            <option value="2 tuần">Khóa 2 tuần</option>
                                            <option value="4 tuần">Khóa 4 tuần</option>
                                            <option value="6 tuần">Khóa 6 tuần</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="form-group row">
                                    <label class="col-sm-3 col-form-label text-right">Học phí</label>
                                    <div class="col-sm-9">
                                        <input type="text" class="form-control" id="fee" readonly />
                                    </div>
                                </div>
                            </form>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-success w-100" id="btnSubmit">Lưu</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <script src="../js/jquery-3.7.1.min.js"></script>
        <script src="../js/bootstrap.bundle.min.js"></script>
        <script>
            $(document).ready(function () {
                const fee = {
                    "2 tuần": 5000000,
                    "4 tuần": 8000000,
                    "6 tuần": 9000000,
                };

                $("#course")
                    .on("change", function () {
                        const choice = $(this).val();
                        $("#fee").val(fee[choice]);
                    })
                    .trigger("change");

                $("#btnSubmit").on("click", function (e) {
                    e.preventDefault();
                    let valid = true;
                    const name = $("#name").val();
                    const gender = $("input[name='gender']:checked").val();
                    const phone = $("#phone").val();
                    const birthday = $("#birthday").val();
                    const birthdayDate = new Date(birthday);
                    const address = $("#address").val();
                    const course = $("#course").val();

                    if (name.length == 0) {
                        $("#errName").text("Họ tên không được bỏ trống");
                        valid = false;
                    } else if (!/^([A-ZÀ-Ỹ][a-zà-ỹ]+)(\s[A-ZÀ-Ỹ][a-zà-ỹ]+)*$/.test(name)) {
                        $("#errName").text("Họ tên phải từ 2 từ trở lên, mỗi ký tự đầu phải viết hoa");
                        valid = false;
                    } else {
                        $("#errName").text("");
                    }

                    if (!gender) {
                        $("#errGender").text("Giới tính không được bỏ trống");
                        valid = false;
                    } else {
                        $("#errGender").text("");
                    }

                    if (phone.length == 0) {
                        $("#errPhone").text("Số điện thoại không được bỏ trống");
                        valid = false;
                    } else if (!/^\d{3}-\d{6}$/.test(phone)) {
                        $("#errPhone").text("Số điện thoại phải  theo định dạng sau: XXX-YYYYYY");
                        valid = false;
                    } else {
                        $("#errPhone").text("");
                    }

                    if (isNaN(birthdayDate.getTime())) {
                        $("#errBirthday").text("Ngày sinh không được bỏ trống");
                        valid = false;
                    } else {
                        const today = new Date();
                        let age = today.getFullYear() - birthdayDate.getFullYear();
                        let m = today.getMonth() - birthdayDate.getMonth();
                        if (m < 0 || (m === 0 && today.getDate() < birthdayDate.getDate())) {
                            age--;
                        }
                        console.log(age);
                        if (age <= 15 || age >= 18) {
                            $("#errBirthday").text("Ngày sinh hợp lệ khi tuổi trên 15 và dưới 18");
                            valid = false;
                        } else {
                            $("#errBirthday").text("");
                        }
                    }

                    if (valid) {
                        const stt = $("table tbody tr").length + 1;
                        const formattedDate = birthdayDate.toLocaleDateString("vi-VN");
                        const newRow = `
                            <tr>
                                <td>${stt}</td>
                                <td>${name}</td>
                                <td>${gender}</td>
                                <td>${phone}</td>
                                <td>${formattedDate}</td>
                                <td>${address}</td>
                                <td>${course}</td>
                                <td>${fee[course]}</td>
                            </tr>`;

                        $("table tbody").append(newRow);
                        $("#form")[0].reset();
                        $("#modalForm").modal("hide");
                    }
                });
            });
        </script>
    </body>
</html>
